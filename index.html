
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>ty's brain dump</title>
  <meta name="author" content="Ng Tze Yang">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  <link rel="canonical" href="http://ngty.github.com/">
  <link href="/favicon.png" rel="shortcut icon" />
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="ty's brain dump" type="application/atom+xml"/>
  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

</head>

<body  >
  <header><hgroup>
  <h1><a href="/">ty's brain dump</a></h1>
  
    <h2>~ non-optimized bits & pieces</h2>
  
</hgroup>

</header>
  <nav role=navigation><ul role=subscription data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="site-search">
    <input type="hidden" name="q" value="site:ngty.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul role=main-navigation>
  <li><a href="/">Index</a></li>
  <li><a href="/blog/archives">Archive</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">



  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/10/oop-vs-dop/">OOP vs DOP</a></h1>
    
    
      <p class="meta">





  



<time datetime="2011-10-10T09:06:00+08:00" pubdate  data-updated="true" >Oct 10<span>th</span>, 2011</time></p>
    
  </header>


  <div class="entry-content"><p>One <a href="http://en.wikipedia.org/wiki/Anti-pattern">anti-pattern</a>
that i come across very frequently while doing rails (&amp; activerecord)
related work is that alot of times, people tend to do DOP
(database oriented programming), when they should instead be doing OOP
(object oriented programming).</p>

<p>Most of the applications we write require support for:</p>

<ul>
<li>modelling our business knowledge, AND</li>
<li>persisting the state of business entities</li>
</ul>


<p>In most rails apps, the above functionalities are provided by the model
layer, which in turn is powered by the orm framework (usually activerecord).
It is important to bear in mind the priority ~ the modelling of business
knowledge. Persistence gets into the equation only when we want to
persist the application&#8217;s state.</p>

<blockquote><p>By placing higher priority on business modelling &amp; less on persistence,
we better allocate our resources to tackle changes in business logic,
abstracting &amp; minimising changes required on (or necessitated by)
the persistence layer.</p></blockquote>

<p>Let&#8217;s set the stage for the classic join-model example of students
attending a class, &amp; how DOP &amp; OOP tackle fare against each other:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Clazz
</span><span class='line'>  has_many :participations
</span><span class='line'>  has_many :students, :through =&gt; :participations
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>class Student
</span><span class='line'>  has_many :participations
</span><span class='line'>  has_many :clazzes, :through =&gt; :participations
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>class Participation
</span><span class='line'>  belongs_to :clazz
</span><span class='line'>  belongs_to :student
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<h2>1) The DOP Way</h2>

<p>Base on the original modelling:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Participation.create(:clazz =&gt; physics_class, :student =&gt; alice)</span></code></pre></td></tr></table></div></figure>


<p>What if there comes a day we need to rename <code>Participation</code> to
<code>ClazzParticipation</code> ? Besides renaming the class <code>Participation</code>,
you also need to:</p>

<ul>
<li>change the above <code>Participation.create</code> to <code>ClazzParticipation.create</code></li>
<li>declare the <code>:class_name</code> for <code>Student#participations</code> &amp;
<code>Clazz#participations</code></li>
</ul>


<p>Changes necessitated by change in business requirements are inevitable
in software engineering, but the above changes are unnecesssary &amp; as
the cause comes from the persistent side, rather than the business
side.</p>

<p>Let&#8217;s improve on this DOP way by trying the hybrid approach.</p>

<h2>2) The hybrid way</h2>

<p>Using the original modelling, we do:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>physics_class.participations.create(:student =&gt; alice)</span></code></pre></td></tr></table></div></figure>


<p>This is better than the pure DOP approach. When renaming of
<code>Participation</code> to <code>ClazzParticipation</code> is required, besides the
obvious renaming of the class <code>Participation</code>, you just need to:</p>

<ul>
<li>declare the <code>:class_name</code> for <code>Student#participations</code> &amp;
<code>Clazz#participations</code></li>
</ul>


<p>Pretty good, but bare in mind that this approach is forcing
other engineers to be aware that:</p>

<blockquote><p>in order to add <strong>alice</strong> (student) to <strong>physics_class</strong>
(class), you create a participation for <strong>alice</strong> w.r.t
<strong>physics_class</strong></p></blockquote>

<p>Clearly, it is still very database centric. This approach misses
the essence of OOP ~ encapsulation. It exposes &amp; forces anyone to
be aware of:</p>

<ul>
<li>the underlying join association <code>Clazz#participations</code>, AND</li>
<li>you have to call <code>Clazz#participations.create</code>, AND</li>
<li>you have to pass the argument <code>:student =&gt; alice</code></li>
</ul>


<p>Can we make it better ?? Of couse we can, let&#8217;s try the following
more OOP approach:</p>

<h2>3) The OOP Way</h2>

<p>With the original modelling,</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>physics_class.students &lt;&lt; alice</span></code></pre></td></tr></table></div></figure>


<p>Read:</p>

<blockquote><p>in order to add <strong>alice</strong> (student) to <strong>physics_class</strong>
(class), you just add <strong>alice</strong> to its list of students</p></blockquote>

<p>That&#8217;s it !! If renaming of <code>Participation</code> to <code>ClazzParticipation</code>
is required, the changes required is the same as the above hybrid
approach.</p>

<h2>Summing Up</h2>

<p>How do you know u are doing DOP or OOP ? I guess if you are
doing good OOP,</p>

<blockquote><p>the code should be so simple that it just reads :)</p></blockquote>
</div>
  
  


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/06/a-little-bit-of-sed-kungfu/">A Little Bit of Sed Kungfu</a></h1>
    
    
      <p class="meta">





  



<time datetime="2011-10-06T23:02:00+08:00" pubdate  data-updated="true" >Oct 6<span>th</span>, 2011</time></p>
    
  </header>


  <div class="entry-content"><p>Just picked up a little bit of <a href="http://www.gnu.org/s/sed/">sed</a>
kungfu today while pairing with
<a href="https://plus.google.com/116177061453197380672/posts">jeff</a>.</p>

<h2>In-place editing with &#8220;-i&#8221;</h2>

<p>If you want to do in-place editing of a file, you can pass the
<code>-i</code> option to sed. Let&#8217;s say we have the following file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sed is cool</span></code></pre></td></tr></table></div></figure>


<p>With:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sed -i /path/to/file -e 's/cool/awesome/'</span></code></pre></td></tr></table></div></figure>


<p>We get:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sed is awesome</span></code></pre></td></tr></table></div></figure>


<p>So how do i acheive this previously ?? This is embarrassing, it
used to be like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /path/to/file | sed 's/cool/awesome' &gt; /path/to/file.new
</span><span class='line'>$ mv /path/to/file.new /path/to/file</span></code></pre></td></tr></table></div></figure>


<h2>Replacing only lines matching pattern</h2>

<p>Let&#8217;s say you have the following file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Vim is really cool,
</span><span class='line'>& sed is cool as well.</span></code></pre></td></tr></table></div></figure>


<p>We want to replace only the line with the occurrence of &#8220;sed&#8221;. We
can acheive it using the script command
<code>/&lt;pattern&gt;/s/&lt;original-text&gt;/&lt;replacement-text&gt;</code>, just like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sed -e '/sed/s/cool/awesome/' /path/to/file</span></code></pre></td></tr></table></div></figure>


<p>This is what we get in stdout:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Vim is really cool,
</span><span class='line'>& sed is awesome as well.</span></code></pre></td></tr></table></div></figure>


<p>Happy Sed-ing :)</p>
</div>
  
  


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/06/installing-the-unofficial-byobu-in-archlinux/">Installing the Unofficial Byobu in Archlinux</a></h1>
    
    
      <p class="meta">





  



<time datetime="2011-10-06T00:20:00+08:00" pubdate  data-updated="true" >Oct 6<span>th</span>, 2011</time></p>
    
  </header>


  <div class="entry-content"><p>If you love <a href="https://launchpad.net/byobu">byobu</a>, &amp; u just decided
to join the <a href="http://www.archlinux.org">archers</a>, you probably will
miss it as you can&#8217;t simply do <code>sudo pacman -S byobu</code>, since the
package isn&#8217;t available on any of the offcial repositories.</p>

<p>DO NOT DESPAIR, there is an unofficial package at the
<a href="http://aur.archlinux.org/">aur</a> (Arch User Repository). Just goto
<a href="http://aur.archlinux.org/">aur</a> to search for it, &amp; copy the link
to the tarball, then:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd /tmp
</span><span class='line'>$ wget http://aur.archlinux.org/packages/by/byobu/byobu.tar.gz
</span><span class='line'>$ tar zxf byobu.tar.gz
</span><span class='line'>$ cd byobu
</span><span class='line'>$ makepkg</span></code></pre></td></tr></table></div></figure>


<p>Depending on how mature ur system is, you may be prompted to
manually install some extra dependencies, note these &amp; run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S &lt;DEPENDENCIES&gt;</span></code></pre></td></tr></table></div></figure>


<p>With all dependencies installed, then:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ makepkg
</span><span class='line'>$ pacman -U *.xz</span></code></pre></td></tr></table></div></figure>


<p>And you can start to rock-&amp;-roll :)</p>
</div>
  
  


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/05/killing-a-screen-window/">Killing a Screen Window</a></h1>
    
    
      <p class="meta">





  



<time datetime="2011-10-05T23:42:00+08:00" pubdate  data-updated="true" >Oct 5<span>th</span>, 2011</time></p>
    
  </header>


  <div class="entry-content"><p>I use <a href="http://www.gnu.org/software/screen/">screen</a> everyday, yet i
must admit i&#8217;ve always been only scratching its surface. Today,
coworker <a href="https://plus.google.com/105093850720627751966/posts">+kelvin</a>
showed me how to kill a screen window with <code>CTRL-a + k</code>.</p>

<p>How did i do it in the past ?? Err, this is embarrassing, i usually
either just type <code>exit</code> in the window.</p>

<p>Finally, let&#8217;s say if u start with windows 1$, 2$, 3$ &amp; 4$. When u
kill 3$, 4$ still retains its &#8220;4&#8221;. To fix this issue, you can
<code>CTRL-a :number 3</code> to reset &#8220;4&#8221; to &#8220;3&#8221;.</p>

<p>PS: a personal todo is to dig into <code>man screen</code> .. or bug someone to
do the digging &amp; teach me :)</p>
</div>
  
  


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/05/removing-untracked-files-with-git-clean/">Removing Untracked Files With Git Clean</a></h1>
    
    
      <p class="meta">





  



<time datetime="2011-10-05T23:10:00+08:00" pubdate  data-updated="true" >Oct 5<span>th</span>, 2011</time></p>
    
  </header>


  <div class="entry-content"><p>The BEST thing abt pair-programming is that it facilitates knowledge
diffusion. Just pick up <code>git clean</code> from coworker
<a href="https://plus.google.com/107105912599855998254/posts">+peer</a>
today.</p>

<p><code>git clean</code> makes it real easy to remove untracked files in ur working
git repo. Files/dirs listed in <code>.gitignore</code> are ignored (as expected),
only those extra untracked files are cleaned off.</p>

<p>Honestly, nothing beats <code>git help clean</code> if u want to learn more abt it.</p>
</div>
  
  


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/03/quick-commenting-of-ruby-code/">Quick Commenting of Ruby Code</a></h1>
    
    
      <p class="meta">





  



<time datetime="2011-10-03T00:36:00+08:00" pubdate  data-updated="true" >Oct 3<span>rd</span>, 2011</time></p>
    
  </header>


  <div class="entry-content"><p>What is the fastest way to comment a block of ruby code ?? Sorry,
i&#8217;m too fast, no time to wait, let&#8217;s install the extra plugins
1st:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd ~/.vim/bundle
</span><span class='line'>$ git clone https://github.com/kana/vim-textobj-user.git
</span><span class='line'>$ https://github.com/nelstrom/vim-textobj-rubyblock.git
</span><span class='line'>$ https://github.com/tomtom/tcomment_vim.git</span></code></pre></td></tr></table></div></figure>


<p>To comment an entire method, goto anywhere of that method,
<code>var</code> &amp; <code>gc</code>.</p>

<p>To comment the inner content of a method, again anywhere of
that method, <code>vir</code> &amp; <code>gc</code>.</p>

<p>Sorry, too fast &amp; too sweet ?? See
<a href="http://vimcasts.org/blog/2010/12/a-text-object-for-ruby-blocks">this vimcast</a>
to learn more abt <code>var</code> &amp; <code>vir</code> :)</p>
</div>
  
  


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/02/the-motion-that-you-must-know/">The Motion That You Must Know</a></h1>
    
    
      <p class="meta">





  



<time datetime="2011-10-02T23:52:00+08:00" pubdate  data-updated="true" >Oct 2<span>nd</span>, 2011</time></p>
    
  </header>


  <div class="entry-content"><p>Let me tell you, <code>i</code> (&#8220;inside&#8221;) is the motion that you MUST know.</p>

<p>Given <code>"this is awesome"</code>, anywhere from the starting <code>"</code> to
the ending one, just do a <code>ci"</code>, you can replace anything within
the quotes. This works for backtick &amp; single-quote char as well,
but not for other delimiters like <code>"/"</code>, <code>"|"</code>, <code>"\"</code>, &#8230;, etc.</p>

<p>Given <code>%(this is awesome)</code>, doing <code>ci(</code> or <code>ci)</code> works as
well. In fact, this works equally well for <code>ci&lt;</code>, <code>ci&gt;</code>, <code>ci[</code>,
<code>ci]</code>, <code>ci{</code> &amp; <code>ci}</code>.</p>

<p>If you have installed the <code>vim-textobj-user</code> &amp;
<code>vim-textobj-rubyblock</code> plugins:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd ~/.vim/bundle
</span><span class='line'>$ git clone https://github.com/kana/vim-textobj-user.git
</span><span class='line'>$ git clone https://github.com/nelstrom/vim-textobj-rubyblock.git</span></code></pre></td></tr></table></div></figure>


<p>You can do <code>cir</code> anywhere from start of a <code>class ... end</code>,
<code>module ... end</code>, <code>def ... end</code>, <code>do ... end</code>, <code>if ... end</code>, &#8230;
to replace the contents within.</p>

<p>Last but not least, you may wish to know the <code>a</code> (stands for &#8220;around&#8221;)
motion as well. Try out <code>ca"</code>, <code>ca(</code>, <code>car</code> &amp; friends.</p>

<p>Have fun !!</p>
</div>
  
  


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/09/30/open-file-and-goto-line/">Open File &amp; Goto Line</a></h1>
    
    
      <p class="meta">





  



<time datetime="2011-09-30T12:37:00+08:00" pubdate  data-updated="true" >Sep 30<span>th</span>, 2011</time></p>
    
  </header>


  <div class="entry-content"><p>I only get to know this recently, you can open a file &amp; goto
a specific line in vim with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /path/to/file +100</span></code></pre></td></tr></table></div></figure>


<p>The above opens <code>/path/to/file</code> &amp; sets u on <code>line 100</code>. When
are already in vim, you can acheive it with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>:e /path/to/another/file +99</span></code></pre></td></tr></table></div></figure>


<p>But this won&#8217;t work for buffer though, meaning NONE of the
following will work :(</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>:b /path/to/another/file +99
</span><span class='line'>:b&lt;id&gt; +99
</span><span class='line'>:b# +99</span></code></pre></td></tr></table></div></figure>



</div>
  
  


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/09/29/flexible-method-arguments-with-the-splat-operator/">Flexible Method Arguments With the Splat Operator</a></h1>
    
    
      <p class="meta">





  



<time datetime="2011-09-29T00:16:00+08:00" pubdate  data-updated="true" >Sep 29<span>th</span>, 2011</time></p>
    
  </header>


  <div class="entry-content"><p>The splat operator allows a method to accepts 0 ~ ruby&#8217;s max number
(hm, i don&#8217;t know what number is that) of arguments, this makes
it super flexible, &amp; here are some ways to take advantage of that:</p>

<h2>1) Probably simple flat list</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">mm</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span class='line'>  <span class="n">args</span><span class="o">.</span><span class="n">each_with_index</span> <span class="p">{</span><span class="o">|</span><span class="n">arg</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">&quot;A[</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">]: </span><span class="si">#{</span><span class="n">arg</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span>
</span><span class='line'><span class="c1"># &gt;&gt; (blank)</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[0]: 1</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[0]: 1</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[1]: 2</span>
</span></code></pre></td></tr></table></div></figure>


<h2>2) May have array &amp; must be flattened</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">mm</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span class='line'>  <span class="o">[</span><span class="n">args</span><span class="o">].</span><span class="n">flatten</span><span class="o">.</span><span class="n">each_with_index</span> <span class="p">{</span><span class="o">|</span><span class="n">arg</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">&quot;A[</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">]: </span><span class="si">#{</span><span class="n">arg</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span>
</span><span class='line'><span class="c1"># &gt;&gt; (blank)</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># same as mm([1])</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[0]: 1</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">]</span><span class="p">)</span> <span class="c1"># same as mm([1], [2]), mm(1, [2]) &amp; mm([1], 2)</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[0]: 1</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[1]: 2</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">)</span> <span class="c1"># same as mm([1, 2, 3]), mm([1], [2, 3]), etc</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[0]: 1</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[1]: 2</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[2]: 3</span>
</span></code></pre></td></tr></table></div></figure>


<h2>3) May want to support options-like usage</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">mm</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span class='line'>  <span class="n">opts</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Hash</span><span class="p">)</span> <span class="p">?</span> <span class="n">args</span><span class="o">.</span><span class="n">pop</span> <span class="p">:</span> <span class="p">{}</span>
</span><span class='line'>  <span class="n">args</span><span class="o">.</span><span class="n">each_with_index</span> <span class="p">{</span><span class="o">|</span><span class="n">arg</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">&quot;A[</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">]: </span><span class="si">#{</span><span class="n">arg</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">opts</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">&quot;O[</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">]: </span><span class="si">#{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span>
</span><span class='line'><span class="c1"># &gt;&gt; (blank)</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="c1"># &gt;&gt; O[x]: 1</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[0]: 1</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[0]: 1</span>
</span><span class='line'><span class="c1"># &gt;&gt; O[x]: 2</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[0]: 1</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[1]: 2</span>
</span><span class='line'><span class="c1"># &gt;&gt; O[x]: 3</span>
</span><span class='line'><span class="c1"># &gt;&gt; O[y]: 4</span>
</span></code></pre></td></tr></table></div></figure>


<h2>4) May want to passing in a code-block</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">mm</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>  <span class="n">args</span><span class="o">.</span><span class="n">each_with_index</span> <span class="p">{</span><span class="o">|</span><span class="n">arg</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">&quot;A[</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">]: </span><span class="si">#{</span><span class="n">arg</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">block</span><span class="o">.</span><span class="n">call</span> <span class="k">if</span> <span class="nb">block_given?</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span>
</span><span class='line'><span class="c1"># &gt;&gt; (blank)</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span> <span class="p">{</span> <span class="s2">&quot;B[*]: rocks&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="c1"># &gt;&gt; B[*]: rocks</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;B[*]: rocks&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[0]: 1</span>
</span><span class='line'><span class="c1"># &gt;&gt; B[*]: rocks</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;B[*]: rocks&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[0]: 1</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[1]: 2</span>
</span><span class='line'><span class="c1"># &gt;&gt; B[*]: rocks</span>
</span></code></pre></td></tr></table></div></figure>


<h2>5) All in one</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">mm</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>  <span class="n">opts</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Hash</span><span class="p">)</span> <span class="p">?</span> <span class="n">args</span><span class="o">.</span><span class="n">pop</span> <span class="p">:</span> <span class="p">{}</span>
</span><span class='line'>  <span class="o">[</span><span class="n">args</span><span class="o">].</span><span class="n">flatten</span><span class="o">.</span><span class="n">each_with_index</span> <span class="p">{</span><span class="o">|</span><span class="n">arg</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">&quot;A[</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">]: </span><span class="si">#{</span><span class="n">arg</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">opts</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">&quot;O[</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">]: </span><span class="si">#{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">block</span><span class="o">.</span><span class="n">call</span> <span class="k">if</span> <span class="nb">block_given?</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;B[*]: rocks&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="c1"># &gt;&gt; O[x]: 4</span>
</span><span class='line'><span class="c1"># &gt;&gt; O[y]: 5</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[0]: 1</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[1]: 2</span>
</span><span class='line'><span class="c1"># &gt;&gt; A[2]: 3</span>
</span><span class='line'><span class="c1"># &gt;&gt; O[x]: 4</span>
</span><span class='line'><span class="c1"># &gt;&gt; O[y]: 5</span>
</span><span class='line'><span class="c1"># &gt;&gt; B[*]: rocks</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Extra Reading</h2>

<p>To advance ur ruby kungfu, you probably want some extra reading from the
<a href="http://github.com/sandal/rbp-book/raw/gh-pages/pdfs/ch02.pdf">free chapter abt designing beautiful apis</a>,
from <a href="http://rubybestpractices.com/">Ruby Best Practices</a>.</p>
</div>
  
  


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/09/28/tripping-over-method-and-local-variable/">Tripping Over Method &amp; Local Variable</a></h1>
    
    
      <p class="meta">





  



<time datetime="2011-09-28T23:14:00+08:00" pubdate  data-updated="true" >Sep 28<span>th</span>, 2011</time></p>
    
  </header>


  <div class="entry-content"><p>As you know, ruby always tries hard to get out of the programmer&#8217;s
way most of the time. One good example is when u invoke a method
that doesn&#8217;t require any argument:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">mm</span>
</span><span class='line'>  <span class="ss">:ok</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">mm</span>   <span class="c1"># &gt;&gt; :ok</span>
</span><span class='line'><span class="n">mm</span><span class="p">()</span> <span class="c1"># &gt;&gt; :ok</span>
</span></code></pre></td></tr></table></div></figure>


<p>Almost always, to invoke <code>mm</code>, <code>mm</code> is preferred over <code>mm()</code>, doing
it the <code>mm()</code> way is so un-rubyish. Yet this flexibility tripped us
over today, consider the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="no">Thing</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">let</span><span class="p">(</span><span class="ss">:alien</span><span class="p">)</span> <span class="p">{</span> <span class="no">Factory</span><span class="p">(</span><span class="ss">:thing</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;alien&#39;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">let</span><span class="p">(</span><span class="ss">:robot</span><span class="p">)</span> <span class="p">{</span> <span class="no">Factory</span><span class="p">(</span><span class="ss">:thing</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;robot&#39;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="sx">%w{alien robot}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">thing</span><span class="o">|</span>
</span><span class='line'>    <span class="n">context</span> <span class="s2">&quot;as </span><span class="si">#{</span><span class="n">thing</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="n">thing</span> <span class="p">}</span>
</span><span class='line'>      <span class="n">let</span><span class="p">(</span><span class="ss">:thing</span><span class="p">)</span> <span class="p">{</span> <span class="nb">send</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>      <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">be_macho</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>When we ran the above spec, we get
<code>undefined method 'macho' for "alien":String (NoMethodError)</code> .. why ??</p>

<p>Here&#8217;s our intended behaviour:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="no">Thing</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">let</span><span class="p">(</span><span class="ss">:alien</span><span class="p">)</span> <span class="p">{</span> <span class="no">Factory</span><span class="p">(</span><span class="ss">:thing</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;alien&#39;</span><span class="p">)</span> <span class="p">}</span> <span class="c1"># defines alien()</span>
</span><span class='line'>  <span class="n">let</span><span class="p">(</span><span class="ss">:robot</span><span class="p">)</span> <span class="p">{</span> <span class="no">Factory</span><span class="p">(</span><span class="ss">:thing</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;robot&#39;</span><span class="p">)</span> <span class="p">}</span> <span class="c1"># defines robot()</span>
</span><span class='line'>
</span><span class='line'>  <span class="sx">%w{alien robot}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">thing</span><span class="o">|</span>  <span class="c1"># set local var thing</span>
</span><span class='line'>    <span class="n">context</span> <span class="s2">&quot;as </span><span class="si">#{</span><span class="n">thing</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="n">thing</span> <span class="p">}</span>      <span class="c1"># defines subject() to return thing()</span>
</span><span class='line'>      <span class="n">let</span><span class="p">(</span><span class="ss">:thing</span><span class="p">)</span> <span class="p">{</span> <span class="nb">send</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span> <span class="p">}</span>  <span class="c1"># defines thing() to return the evaluate alien() or robot()</span>
</span><span class='line'>      <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">be_macho</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is what happened instead:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="no">Thing</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">let</span><span class="p">(</span><span class="ss">:alien</span><span class="p">)</span> <span class="p">{</span> <span class="no">Factory</span><span class="p">(</span><span class="ss">:thing</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;alien&#39;</span><span class="p">)</span> <span class="p">}</span> <span class="c1"># defines alien()</span>
</span><span class='line'>  <span class="n">let</span><span class="p">(</span><span class="ss">:robot</span><span class="p">)</span> <span class="p">{</span> <span class="no">Factory</span><span class="p">(</span><span class="ss">:thing</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;robot&#39;</span><span class="p">)</span> <span class="p">}</span> <span class="c1"># defines robot()</span>
</span><span class='line'>
</span><span class='line'>  <span class="sx">%w{alien robot}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">thing</span><span class="o">|</span> <span class="c1"># set local var thing</span>
</span><span class='line'>    <span class="n">context</span> <span class="s2">&quot;as </span><span class="si">#{</span><span class="n">thing</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="n">thing</span> <span class="p">}</span>     <span class="c1"># ** defines subject() to return the local var thing</span>
</span><span class='line'>      <span class="n">let</span><span class="p">(</span><span class="ss">:thing</span><span class="p">)</span> <span class="p">{</span> <span class="nb">send</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span> <span class="p">}</span> <span class="c1"># ** defines thing() which never gets invoked</span>
</span><span class='line'>      <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">be_macho</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>To fix the problem, we can either:</p>

<ul>
<li><p>avoid confusing names by renaming the local variable <code>thing</code> to
<code>_thing</code> &amp; amend all its intended usage accordingly (which include
<code>let(:thing) { send(thing) }</code> to <code>let(:thing) { send(_thing) }</code>), OR</p></li>
<li><p>be explicte when invoking method by rewriting
<code>let(:subject) { thing }</code> as <code>let(:subject) { thing() }</code></p></li>
</ul>

</div>
  
  


  </article>

<nav role="pagination">
  <div>
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Archive</a>
    
  </div>
</nav>

<script type="text/javascript">
    var disqus_shortname = 'tybraindump';
    (function () {
      var s = document.createElement('script'); s.async = true;
      s.type = 'text/javascript';
      s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</div>
<aside role=sidebar>
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2011/10/10/oop-vs-dop/">OOP vs DOP</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/10/06/a-little-bit-of-sed-kungfu/">A Little Bit of Sed Kungfu</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/10/06/installing-the-unofficial-byobu-in-archlinux/">Installing The Unofficial Byobu in Archlinux</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/10/05/killing-a-screen-window/">Killing a Screen Window</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/10/05/removing-untracked-files-with-git-clean/">Removing Untracked Files With Git Clean</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer><p>
  Copyright &copy; 2011 - Ng Tze Yang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

  
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


  

</body>
</html>
